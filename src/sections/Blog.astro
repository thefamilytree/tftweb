---
import { sanityClient } from '../lib/sanityClient';
import { urlFor } from '../lib/sanityClient';

const BLOGPOSTS_QUERY = `*[_type == "blogPost"] {
  _id,
  title,
  slug,
  description,
  image,
  author -> {
    name,
    image},
  publishedAt
}`;

const blogPosts = await sanityClient.fetch(BLOGPOSTS_QUERY);
---

<section id="blog" class="container">
  <h4>The Family Tree Blog</h4>
  <div class="blog-posts">
    {
      blogPosts.map((post: any) => (
        <article class="blog-post">
          <div class="blog-post-content">
            <h2 class="blog-title">{post.title}</h2>
            <p class="blog-description">{post.description}</p>
            <div class="blog-author">
              {post.author && (
                <div class="blog-author">
                  {post.author.image && (
                    <img
                      src={urlFor(post.author.image).url()}
                      alt={post.author.name || 'Author'}
                      class="author-image"
                    />
                  )}
                  {post.author.name && <span class="author-name">{post.author.name}</span>}
                </div>
              )}
            </div>
            <a href={`/blog/${post.slug.current}`} class="read-more">
              Read more
            </a>
          </div>
          {post.image && (
            <div class="blog-image-wrapper">
              <img src={urlFor(post.image).url()} alt={post.title} class="blog-image" />
            </div>
          )}
        </article>
      ))
    }
  </div>
</section>

<style lang="scss">
  @import '../styles/basic';
  h4 {
    margin: 0;
    text-align: center;
    width: 100%;
  }
  #blog {
    padding-block: 10rem;
    padding-block-end: 5rem;
    background-color: #fff;

    h3 {
      text-align: center;
    }

    .blog-posts {
      display: flex;
      flex-direction: column;
      gap: 0;
      width: 100%;
      margin-top: 4rem;
    }

    .blog-post {
      display: flex;
      flex-direction: row;
      gap: 4rem;
      align-items: flex-start;
      padding-block: 3rem;
      width: 100%;
      border-top: 1px solid #e0e0e0;

      &:first-child {
        border-top: none;
        padding-top: 0;
      }

      &:last-child {
        padding-bottom: 0;
      }

      @include mobile {
        flex-direction: column;
        gap: 2rem;
        padding-block: 2rem;
      }

      @include tablet {
        flex-direction: row;
        gap: 2rem;
      }
    }

    .blog-post-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      min-width: 0;
      max-width: 100%;

      @include mobile {
        gap: 1.25rem;
      }
    }

    .blog-title {
      font-size: 1.25rem;
      font-weight: 700;
      text-transform: uppercase;
      color: #1a1a1a;
      margin: 0;
      line-height: 1.4;
      letter-spacing: 0.5px;

      @include mobile {
        font-size: 1.1rem;
        line-height: 1.3;
      }
    }

    .blog-description {
      font-size: 1rem;
      line-height: 1.7;
      color: #4a4a4a;
      opacity: 0.9;
      margin: 0;

      @include mobile {
        font-size: 0.95rem;
        line-height: 1.6;
      }
    }

    .blog-author {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-top: 0.5rem;

      .author-image {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        flex-shrink: 0;

        @include mobile {
          width: 35px;
          height: 35px;
        }
      }

      .author-name {
        font-size: 0.95rem;
        color: #333;
        font-weight: 500;

        @include mobile {
          font-size: 0.9rem;
        }
      }
    }

    .read-more {
      font-size: 1rem;
      color: #1a1a1a;
      text-decoration: underline;
      margin-top: 0.5rem;
      display: inline-block;
      width: fit-content;
      transition: opacity 0.3s ease;

      &:hover {
        opacity: 0.7;
        cursor: pointer;
      }

      @include mobile {
        font-size: 0.95rem;
      }
    }

    .blog-image-wrapper {
      flex: 0 0 auto;
      width: 40%;
      height: auto;
      overflow: hidden;

      @include mobile {
        width: 100%;
        height: 250px;
        order: -1; // Show image first on mobile
      }

      @include tablet {
        width: 50%;
        height: 300px;
        // order: -1; // Show image first on tablet
      }
    }

    .blog-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }
  }
</style>
